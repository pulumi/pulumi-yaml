resources:
    aws_vpc:
        type: aws:ec2/vpc:Vpc
        properties:
            cidrBlock: 10.0.0.0/16
            instanceTenancy: default
    privateS3VpcEndpoint:
        type: aws:ec2/vpcEndpoint:VpcEndpoint
        properties:
            vpcId: ${aws_vpc.id}
            serviceName: com.amazonaws.us-west-2.s3
    bar:
        type: aws:ec2/networkAcl:NetworkAcl
        properties:
            vpcId: ${aws_vpc.id}
    privateS3NetworkAclRule:
        type: aws:ec2/networkAclRule:NetworkAclRule
        properties:
            networkAclId: ${bar.id}
            ruleNumber: 200
            egress: false
            protocol: tcp
            ruleAction: allow
            cidrBlock: ${privateS3PrefixList.cidrBlocks[0]}
            fromPort: 443
            toPort: 443
variables:
    privateS3PrefixList:
        Fn::Invoke:
            Function: aws:ec2/getPrefixList:getPrefixList
            Arguments:
                prefixListId: ${privateS3VpcEndpoint.prefixListId}
    amis:
        Fn::Invoke:
            Function: aws:ec2/getAmiIds:getAmiIds
            Arguments:
                owners:
                    - ${bar.id}
                filters:
                    - name: ${bar.id}
                      values:
                        - pulumi*
